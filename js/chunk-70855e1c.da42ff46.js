(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-70855e1c"],{"048b":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("mew-popup",{attrs:{"max-width":"690px",show:e.openWithdrawalModal,"has-buttons":!1,"has-body-content":!0,title:e.modalTitle,"left-btn":e.leftBtn}},[s("div",[1===e.step?s("div",{staticClass:"text-center"},[s("mew-warning-sheet",{staticClass:"mb-5",attrs:{title:"",description:"The withdrawal address can only be set once and can never be changed. Please make sure the withdrawal address you are setting is a non-custodial wallet to which you have full access with a recovery phrase or private key. Do NOT use an exchange address or a smart contract wallet."}}),s("div",{staticClass:"mew-heading-3 mb-3 text-left"},[e._v("Your Withdrawal Address")]),s("module-address-book",{ref:"addressInput",staticClass:"AddressInput",attrs:{label:"Address","preselect-curr-wallet-adr":!0,currency:e.currencyName},on:{setAddress:e.setAddress}})],1):e._e(),2===e.step?s("div",{staticClass:"text-center"},[e._l(e.buttons,(function(t,a){return s("div",{key:a,staticClass:"mb-5"},[s("mew-button",{class:t.class,staticStyle:{height:"160px"},attrs:{"has-full-width":"","color-theme":"greyMedium","btn-style":"outline"},nativeOn:{click:function(e){return t.fn.apply(null,arguments)}}},[s("div",{staticClass:"text-left d-flex align-center justify-space-between px-2",staticStyle:{width:"100%"}},[s("div",{staticClass:"mew-heading-2 textDark--text"},[e._v(" "+e._s(t.label)+" ")]),s("img",{staticClass:"mr-4 d-none d-sm-block",attrs:{width:"80",src:t.icon}})])])],1)})),s("input",{ref:"jsonInput",staticStyle:{display:"none"},attrs:{type:"file",name:"file"},on:{change:e.uploadFile}})],2):e._e(),3===e.step?s("div",{staticClass:"text-center"},[e.isKeystore?s("div",[s("mew-input",{ref:"passwordInput",attrs:{label:"Enter Password",placeholder:"Enter my keystore password",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1):e._e(),e.isMnemonic?s("div",[s("phrase-block",{staticClass:"mb-8"},[s("v-row",e._l(e.length,(function(t){return s("v-col",{key:"mnemonicInput"+t,attrs:{cols:"6",lg:"3",md:"3",sm:"4"}},[s("v-text-field",{ref:"mnemonicInput"+t,refInFor:!0,attrs:{name:"mnemonicInput"+t,label:t+".",autocomplete:"off",autofocus:1===t},model:{value:e.phrase[t],callback:function(s){e.$set(e.phrase,t,s)},expression:"phrase[n]"}})],1)})),1)],1)],1):e._e()]):e._e(),4===e.step?s("div",{staticClass:"mb-2"},[s("mew-sheet",{staticClass:"pa-4"},[s("div",{staticClass:"mew-heading-3 black--text"},[e._v(" Setting address: "+e._s(e.executionAddress)+" as the withdrawal address. ")])]),s("mew-warning-sheet",{staticClass:"my-4",attrs:{title:"Please verify",description:"The withdrawal address can only be set once. Please make sure you are setting the correct address."}})],1):e._e(),s("div",{staticClass:"mb-2 text-center d-flex align-center justify-center"},[e.step>1?s("mew-button",{staticClass:"mr-2",attrs:{title:"Back","btn-style":"outline","btn-size":"xlarge"},nativeOn:{click:function(t){return function(){e.back()}.apply(null,arguments)}}}):e._e(),2!=e.step?s("mew-button",{attrs:{title:e.nextButton.title,disabled:e.nextButton.disabled,loading:e.loadingButton,"btn-size":"xlarge"},nativeOn:{click:function(t){return function(){e.nextButton.fn()}.apply(null,arguments)}}}):e._e()],1)])])},i=[],n=(s("e9c4"),s("caad"),s("2f62")),r=s("35be"),l=s("9b88"),d=s("9609"),o=s("2ef0"),c={components:{phraseBlock:()=>s.e("chunk-04918fe0").then(s.bind(null,"a2c8")),ModuleAddressBook:()=>s.e("chunk-419c3612").then(s.bind(null,"4b90"))},props:{reset:{type:Function,default:()=>{}},openWithdrawalModal:{type:Boolean,default:!1},selectedValidator:{type:Object,default:()=>{}}},data(){return{step:1,executionAddress:"",isValidAddress:!1,selectedRecoveryType:"",file:{},password:"",blsExecution:"",phrase:{},length:24,loadingButton:!1}},computed:{...Object(n["e"])("wallet",["address"]),...Object(n["c"])("global",["network"]),nextButton(){const e={title:"Next",disabled:!1,fn:this.nextStep};return 1===this.step?Object.assign({},e,{disabled:!this.isValidAddress&&""!==this.executionAddress,fn:this.nextStep}):3===this.step?this.isKeystore?Object.assign({},e,{disabled:this.loadingButton||!this.validPassword,fn:this.validateUserInputs}):Object.assign({},e,{disabled:!this.isValidMnemonic,fn:this.validateUserInputs}):4===this.step?Object.assign({},e,{title:"Set withdrawal address",disabled:this.loadingButton,fn:this.setWithdrawalAddress}):e},phraseToLength(){const e=Object.values(this.phrase);return e.length>this.length&&(e.length=this.length),e},isValidMnemonic(){return this.phraseToLength.length===this.length},parsedPhrase(){return this.phraseToLength.join(" ").toLowerCase()},buttons(){return[{label:"Keystore",icon:s("041b"),fn:()=>{this.userSelectFile()}},{label:"Mnemonic Phrase",icon:s("58fb"),fn:()=>{this.setType(d["a"].MNEMONIC)}}]},currencyName(){return this.network.type.currencyName},leftBtn(){return{text:"Cancel",color:"basic",method:this.closeModal}},modalTitle(){return 1===this.step?"Provide withdrawal address":2===this.step?"Choose recovery method":3===this.step&&this.isKeystore?"Enter Keystore Password":3===this.step&&this.isMnemonic?"Enter Mnemonic Phrase":4===this.step?"Verify details":""},isKeystore(){return this.selectedRecoveryType===d["a"].KEYSTORE},isMnemonic(){return this.selectedRecoveryType===d["a"].MNEMONIC},validPassword(){return this.password.length>3}},watch:{phrase:{deep:!0,handler:function(e){if(e&&!Object(o["isEmpty"])(e)&&!Object(o["isEmpty"])(e[1])){this.checkPhrase(e);const t=e[1].split(" ");if(12===t.length||24===t.length){this.length=t.length;const e={};t.forEach((t,s)=>{e[s+1]=t.toLowerCase()}),this.phrase=e}}}}},methods:{...Object(n["b"])("stakedStore",["addValidatorIndex"]),setWithdrawalAddress(){const e="ETH"===this.network.type.name?"mainnet":"staging",t=`https://${e}.mewwallet.dev/v2/stake/upgrade`;this.blsExecution.message.validator_index=parseInt(this.blsExecution.message.validator_index),this.loadingButton=!0,fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({signed:[this.blsExecution]})}).then(e=>e.ok?(this.addValidatorIndex(this.selectedValidator.validator_index),void Object(l["e"])("Successfully set withdrawal address!",{},l["d"])):e.json().then(e=>{JSON.stringify(e).includes("withdrawal credential prefix is not a BLS prefix")?(this.addValidatorIndex(this.selectedValidator.validator_index),Object(l["e"])("Withdrawal credentials are already set for this validator",{},l["f"])):Object(l["e"])(e.error?e.error:e.msg,{},l["a"])})).finally(()=>{this.clear()})},checkPhrase(e){const t={};let s=!1;Object.values(e).forEach((e,a)=>{Object(o["isEmpty"])(e)?s=!0:t[a+1]=e.toLowerCase()}),s&&(this.phrase=t)},async validateUserInputs(){this.loadingButton=!0;try{this.validating=!0;const e="ETH"===this.network.type.name?"mainnet":"goerli";this.isKeystore?this.blsExecution=await Object(r["keystoreToBLSExecution"])(this.file,this.password,this.executionAddress,this.selectedValidator.validator_index,"0x"+this.selectedValidator.decoded.withdrawal_credentials,e):this.blsExecution=await Object(r["mnemonicToBLSExecution"])({mnemonic:this.parsedPhrase},this.executionAddress,this.selectedValidator.validator_index,"0x"+this.selectedValidator.decoded.withdrawal_credentials,e),this.loadingButton=!1,this.nextStep()}catch(e){this.loadingButton=!1,Object(l["e"])(e,{},l["a"]),this.clear()}},clear(){this.$refs.addressInput&&this.$refs.addressInput.clear(),this.step=1,this.executionAddress=this.address,this.isValidAddress=!1,this.selectedRecoveryType="",this.file={},this.password="",this.blsExecution="",this.phrase={},this.loadingButton=!1,this.reset()},setType(e){this.selectedRecoveryType=e,this.nextStep()},uploadFile(e){const t=new FileReader;t.onloadend=e=>{try{this.file=JSON.parse(e.target.result),this.setType(d["a"].KEYSTORE)}catch(t){Object(l["e"])(t.message,{},l["a"])}},t.readAsBinaryString(e.target.files[0])},userSelectFile(){const e=this.$refs.jsonInput;e.value="",e.click()},nextStep(){this.step+=1},back(){const e=this.$refs.jsonInput;switch(this.step){case 2:this.selectedRecoveryType="",e.value="";break;case 3:this.password="",this.phrase={},this.file={};break;default:break}this.step-=1},setAddress(e,t){this.executionAddress=e,this.isValidAddress=t},closeModal(){this.clear()}}},h=c,u=(s("451f"),s("2877")),p=Object(u["a"])(h,a,i,!1,null,"0ff66ed6",null);t["default"]=p.exports},"1fb0":function(e,t,s){},"451f":function(e,t,s){"use strict";s("1fb0")},"58fb":function(e,t,s){e.exports=s.p+"img/icon-mnemonic.7c3d34fc.svg"}}]);
//# sourceMappingURL=../sourcemaps/js/chunk-70855e1c.da42ff46.js.map